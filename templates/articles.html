{{define "content"}}
<div class="container">
    <div class="level is-mobile" style="flex-wrap: nowrap">
        <div class="level-left" style="flex-shrink: 1; min-width: 0;">
            <h1 class="title is-size-4-mobile" style="overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">All Articles</h1>
        </div>
        <div class="level-right" style="flex-shrink: 0; margin-left: 1rem;">
            <button class="button is-light" 
                    hx-get="/articles" 
                    hx-target="#content-area">
                <span class="icon">â†»</span>
            </button>
        </div>
    </div>

    {{range .Articles}}
    <div class="box">
        <article class="media">
            <div class="media-content">
                <div class="content">
                    <p>
                        <strong>{{.Title}}</strong>
                        {{if .Author}}<small>by {{.Author}}</small>{{end}}
                        <small>{{.PublishedAt.Format "Jan 02, 2006"}}</small>
                        {{if .FeedTitle}}<small class="ml-2">from {{.FeedTitle}}</small>{{end}}
                        {{if .ShouldShowDescription}}
                        <br>
                        {{.TruncatedDescription | safeHTML}}
                        {{end}}
                    </p>
                </div>
                <div class="buttons is-flex is-flex-wrap-nowrap">
                    <a href="{{.URL}}" target="_blank">
                        <span class="button is-small is-link">Original</span>
                    </a>
                    {{if .HasViewableContent}}
                    <a>
                        <span class="button is-small is-info" 
                              hx-get="/articles/{{.ID}}/content"
                              hx-target="#modal-container"
                              hx-trigger="click"
                              onclick="showModalContainer()">Quick View</span>
                    </a>
                    <a href="/article/{{.ID}}">
                        <span class="button is-small is-info">Page View</span>
                    </a>
                    {{end}}
                </div>
            </div>
        </article>
    </div>
    {{end}}

    <!-- Add a container for the modal -->
    <div id="modal-container"></div>

    <nav class="pagination is-centered" role="navigation" aria-label="pagination">
        <a class="pagination-previous {{if eq .CurrentPage 1}}is-disabled{{end}}" 
           {{if gt .CurrentPage 1}}
           hx-get="/articles?page={{subtract .CurrentPage 1}}" 
           hx-target="#content-area"
           hx-push-url="true"
           onclick="delayedSmoothScroll('#content-area')" 
           {{end}}>
            Previous
        </a>
        <a class="pagination-next {{if eq .CurrentPage .TotalPages}}is-disabled{{end}}" 
           {{if lt .CurrentPage .TotalPages}} 
           hx-get="/articles?page={{add .CurrentPage 1}}" 
           hx-target="#content-area"
           hx-push-url="true"
           onclick="delayedSmoothScroll('#content-area')" 
           {{end}}>
            Next
        </a>
        <ul class="pagination-list">
            {{range .Pages}}
            <li>
                <a class="pagination-link {{if eq . $.CurrentPage}}is-current{{end}}" 
                   hx-get="/articles?page={{.}}"
                   hx-target="#content-area" 
                   hx-push-url="true"
                   onclick="delayedSmoothScroll('#content-area')">{{.}}</a>
            </li>
            {{end}}
        </ul>
    </nav>
</div>

<script>
    function openModal(modalId) {
        document.getElementById(modalId).classList.add('is-active');
        document.documentElement.classList.add('is-clipped');
    }

    function closeModal(modalId) {
        document.getElementById(modalId).classList.remove('is-active');
        document.documentElement.classList.remove('is-clipped');
    }

    function showModalContainer() {
        document.documentElement.classList.add('is-clipped');
    }

    function closeModal() {
        document.documentElement.classList.remove('is-clipped');
        document.getElementById('modal-container').innerHTML = '';
    }
</script>
{{end}}